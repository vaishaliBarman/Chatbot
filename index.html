<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hindi Chatbot</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- Floating Chatbot Widget -->
<div class="chatbot-container container d-flex justify-content-center">
  <div class="chatbot-header">
     CHATBOT
  </div>

  <div id="chatbox" class="chatbox"></div>

  <div class="chatbot-input">
    <input type="text" id="userInput" placeholder="‡§Ö‡§™‡§®‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≤‡§ø‡§ñ‡•á‡§Ç..." />
    <button onclick="sendMessage()">‚û§</button>
  </div>
</div>

<script>
  let responses = {};

// Load responses from Moodle.json
fetch('Moodle.json')
  .then(response => response.json())
  .then(data => {
    responses = data;
    console.log("Responses loaded:", responses);
  })
  .catch(error => {
    console.error("Error loading Moodle.json:", error);
    appendMessage("Answer: ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü ‡§ó‡§à‡•§", 'bot');
  });

const chatbox = document.getElementById('chatbox');
const userInput = document.getElementById('userInput');

// Append message to chat
function appendMessage(text, sender) {
  const msgWrapper = document.createElement('div');
  msgWrapper.className = 'message-wrapper ' + sender;

  const avatar = document.createElement('div');
  avatar.className = 'avatar';
  avatar.innerHTML = sender === 'user' ? 'üßë' : 'ü§ñ';

  const msg = document.createElement('div');
  msg.className = 'message';
  msg.textContent = text;

  msgWrapper.appendChild(avatar);
  msgWrapper.appendChild(msg);

  chatbox.appendChild(msgWrapper);
  msgWrapper.classList.add('slide-in');
  chatbox.scrollTop = chatbox.scrollHeight;
}

// Calculate similarity between two strings (0 to 1)
function getSimilarity(a, b) {
  a = a.toLowerCase();
  b = b.toLowerCase();
  let matches = 0;
  let len = Math.max(a.length, b.length);

  for (let i = 0; i < Math.min(a.length, b.length); i++) {
    if (a[i] === b[i]) matches++;
  }

  return matches / len;
}

// Process user input and respond
function sendMessage() {
  let input = userInput.value.trim().toLowerCase();
  if (!input) return;

  appendMessage("‡§Ü‡§™: " + userInput.value, 'user');

  let found = false;

  // Exact match
  if (input in responses) {
    appendMessage("Answer: " + responses[input], 'bot');
    found = true;
  } else {
    // Fuzzy matching
    let bestMatch = '';
    let highestScore = 0;

    for (let key in responses) {
      let score = getSimilarity(input, key.toLowerCase());
      if (score > highestScore) {
        highestScore = score;
        bestMatch = key;
      }
    }

    if (highestScore >= 0.45) {
      appendMessage("Answer: " + responses[bestMatch], 'bot');
      found = true;
    }
  }

  if (!found) {
    appendMessage("Answer: ‡§Æ‡§æ‡§´‡§º ‡§ï‡•Ä‡§ú‡§ø‡§è, ‡§Æ‡•à‡§Ç ‡§∏‡§Æ‡§ù ‡§®‡§π‡•Ä‡§Ç ‡§™‡§æ‡§Ø‡§æ‡•§", 'bot');
  }

  userInput.value = '';
  userInput.focus();
}

// Handle Enter key
userInput.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    sendMessage();
  }
});
  // Auto-focus input on page load
  window.onload = function() {
    userInput.focus();
  };
</script>

</body>
</html>
